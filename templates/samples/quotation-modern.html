<!DOCTYPE html>
<!--
  Pacific Bending Quotation Template (Modern HTML)

  Carbone.io HTML Template for PDF generation.
  Uses all available variables from QuotationMapper.

  Usage:
    - Upload to Carbone service or use via API
    - Renders to PDF with professional styling

  Variables Reference:
    Header: quote_number, customer_name, transaction_date, valid_till, etc.
    Items: items[i].item_code, items[i].description, items[i].qty, etc.
    Computed: grand_total, subtotal, tax_total, item_count, etc.
    Company: company.name, company.address, company.phone, etc.
-->
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quotation {d.quote_number}</title>
  <style>
    /* ============================================
       CSS Reset & Base Styles
       ============================================ */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, 'Helvetica Neue', Arial, sans-serif;
      font-size: 10pt;
      line-height: 1.5;
      color: #1a1a2e;
      background: #ffffff;
      padding: 0;
      margin: 0;
    }

    /* ============================================
       Page Layout (US Letter: 8.5" × 11")
       ============================================ */
    @page {
      size: letter;
      margin: 0;
    }

    .page {
      width: 8.5in;
      min-height: 11in;
      margin: 0 auto;
      padding: 0.5in 0.6in;
      background: #ffffff;
      position: relative;
      overflow: hidden;
    }

    /* Ensure proper stacking context for page elements */
    .page > * {
      position: relative;
    }

    /* ============================================
       Header Section
       ============================================ */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 10px;
      padding-bottom: 10px;
      border-bottom: 3px solid #2c3e50;
    }

    .company-info {
      flex: 1;
    }

    .company-name {
      font-size: 18pt;
      font-weight: 700;
      color: #2c3e50;
      margin-bottom: 6px;
      letter-spacing: -0.5px;
    }

    .company-details {
      font-size: 8.5pt;
      color: #5d6d7e;
      line-height: 1.5;
    }

    .company-details p {
      margin: 1px 0;
    }

    .document-info {
      text-align: right;
      min-width: 180px;
    }

    .document-title {
      font-size: 20pt;
      font-weight: 300;
      color: #2c3e50;
      text-transform: uppercase;
      letter-spacing: 2px;
      margin-bottom: 10px;
    }

    .document-number {
      font-size: 13pt;
      font-weight: 600;
      color: #e74c3c;
      margin-bottom: 6px;
    }

    /* Status Badge - Inline pill next to quote number */
    .status-badge {
      display: inline-block;
      font-size: 8pt;
      font-weight: 600;
      padding: 2px 8px;
      border-radius: 10px;
      margin-left: 8px;
      vertical-align: middle;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .status-badge.draft {
      background: #f39c12;
      color: #ffffff;
    }

    .status-badge.submitted {
      background: #3498db;
      color: #ffffff;
    }

    .status-badge.ordered {
      background: #27ae60;
      color: #ffffff;
    }

    .status-badge.cancelled {
      background: #95a5a6;
      color: #ffffff;
    }

    .document-dates {
      font-size: 8.5pt;
      color: #7f8c8d;
    }

    .document-dates p {
      margin: 2px 0;
    }

    .document-dates strong {
      color: #2c3e50;
    }

    /* ============================================
       Customer Section - 3-Column Grid
       ============================================ */
    .info-grid {
      display: grid;
      grid-template-columns: 2fr 1fr 1fr;
      gap: 12px;
      margin-bottom: 12px;
    }

    .info-card {
      background: #f8f9fa;
      padding: 10px 12px;
      border-radius: 4px;
      border-left: 3px solid #3498db;
    }

    .info-card.prepared-by {
      border-left-color: #27ae60;
    }

    .info-card.details {
      border-left-color: #9b59b6;
    }

    .info-label {
      font-size: 7.5pt;
      text-transform: uppercase;
      letter-spacing: 1.2px;
      color: #7f8c8d;
      margin-bottom: 6px;
      font-weight: 600;
    }

    .info-name {
      font-size: 11pt;
      font-weight: 600;
      color: #2c3e50;
      margin-bottom: 4px;
    }

    .info-details {
      font-size: 8.5pt;
      color: #5d6d7e;
      white-space: pre-line;
      line-height: 1.4;
    }

    .info-contact {
      margin-top: 8px;
      padding-top: 8px;
      border-top: 1px solid #e0e0e0;
      font-size: 8.5pt;
    }

    .info-contact p {
      margin: 2px 0;
      color: #5d6d7e;
    }

    .info-contact strong {
      color: #2c3e50;
    }

    /* Details card styling */
    .details-row {
      display: flex;
      justify-content: space-between;
      font-size: 8.5pt;
      margin: 3px 0;
    }

    .details-row .label {
      color: #7f8c8d;
    }

    .details-row .value {
      font-weight: 600;
      color: #2c3e50;
    }

    /* ============================================
       Line Items Table
       ============================================ */
    .items-section {
      margin-bottom: 12px;
      page-break-inside: avoid;
    }

    .section-title {
      font-size: 10pt;
      font-weight: 600;
      color: #2c3e50;
      margin-bottom: 6px;
      padding-bottom: 3px;
      border-bottom: 2px solid #ecf0f1;
    }

    .items-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 8.5pt;
    }

    .items-table thead {
      background: #34495e;
      color: #ffffff;
    }

    .items-table th {
      padding: 6px 8px;
      text-align: left;
      font-weight: 600;
      text-transform: uppercase;
      font-size: 7.5pt;
      letter-spacing: 0.5px;
    }

    .items-table th.text-right,
    .items-table td.text-right {
      text-align: right;
    }

    .items-table th.text-center,
    .items-table td.text-center {
      text-align: center;
    }

    .items-table tbody tr {
      border-bottom: 1px solid #f0f0f0;
    }

    .items-table tbody tr:nth-child(even) {
      background: #fafafa;
    }

    .items-table tbody tr:hover {
      background: #f5f7fa;
    }

    .items-table td {
      padding: 6px 8px;
      vertical-align: top;
    }

    .item-code {
      font-weight: 600;
      color: #2c3e50;
      font-size: 8.5pt;
    }

    .item-description {
      color: #5d6d7e;
      font-size: 8pt;
      margin-top: 2px;
    }

    .item-notes {
      color: #7f8c8d;
      font-size: 7.5pt;
      font-style: italic;
      margin-top: 4px;
      padding-top: 4px;
      border-top: 1px dashed #e0e0e0;
    }

    .item-lead-time {
      display: inline-block;
      background: #fff3cd;
      color: #856404;
      font-size: 7pt;
      padding: 2px 5px;
      border-radius: 3px;
      margin-top: 3px;
    }

    .item-dimensions {
      font-size: 7.5pt;
      color: #7f8c8d;
      margin-top: 2px;
    }

    /* ============================================
       Totals Section - Combined with Validity
       ============================================ */
    .totals-validity-section {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 14px;
      page-break-inside: avoid;
      gap: 20px;
    }

    .validity-notice {
      flex: 1;
      background: #fff8e1;
      border: 1px solid #ffe082;
      border-left: 3px solid #f39c12;
      padding: 10px 12px;
      border-radius: 4px;
      font-size: 8.5pt;
      color: #7f6003;
      line-height: 1.5;
    }

    .validity-notice strong {
      color: #5d4507;
    }

    .validity-icon {
      font-size: 10pt;
      margin-right: 4px;
    }

    .totals-box {
      width: 240px;
      background: #f8f9fa;
      border-radius: 4px;
      overflow: hidden;
      flex-shrink: 0;
    }

    .totals-row {
      display: flex;
      justify-content: space-between;
      padding: 6px 10px;
      border-bottom: 1px solid #e8e8e8;
      font-size: 9pt;
    }

    .totals-row:last-child {
      border-bottom: none;
    }

    .totals-row.discount {
      color: #27ae60;
    }

    .totals-row.freight {
      color: #8e44ad;
    }

    .totals-row.grand-total {
      background: #2c3e50;
      color: #ffffff;
      font-size: 11pt;
      font-weight: 600;
      padding: 8px 10px;
    }

    .totals-label {
      color: #5d6d7e;
    }

    .totals-row.grand-total .totals-label {
      color: rgba(255,255,255,0.8);
    }

    .totals-value {
      font-weight: 600;
      color: #2c3e50;
    }

    .totals-row.grand-total .totals-value {
      color: #ffffff;
    }

    /* ============================================
       Terms & Notes Section
       ============================================ */
    .terms-section {
      margin-bottom: 12px;
      page-break-inside: avoid;
    }

    .terms-content {
      background: #fafafa;
      padding: 12px 14px;
      border-radius: 4px;
      border: 1px solid #e0e0e0;
      font-size: 9.5pt;
      color: #4a5568;
      white-space: pre-line;
      line-height: 1.6;
    }

    /* ============================================
       Footer Section - Compact Single Line
       ============================================ */
    .footer {
      margin-top: 16px;
      padding-top: 10px;
      border-top: 1px solid #e0e0e0;
      text-align: center;
      font-size: 8pt;
      color: #95a5a6;
    }

    .footer-contact {
      margin-bottom: 4px;
    }

    .footer-contact span {
      margin: 0 6px;
    }

    .footer-tagline {
      font-style: italic;
      color: #a0aec0;
    }

    /* ============================================
       Signature Section - Compact
       ============================================ */
    .signature-section {
      display: flex;
      justify-content: space-between;
      margin-top: 20px;
      gap: 30px;
      page-break-inside: avoid;
    }

    .signature-box {
      flex: 1;
      text-align: center;
    }

    .signature-line {
      border-bottom: 1px solid #2c3e50;
      height: 30px;
      margin-bottom: 5px;
    }

    .signature-label {
      font-size: 7.5pt;
      color: #7f8c8d;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    /* ============================================
       Print Styles
       ============================================ */
    @media print {
      body {
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
      }

      .page {
        width: 100%;
        min-height: auto;
        padding: 0;
      }

      .items-table thead {
        background: #34495e !important;
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
      }

      .totals-row.grand-total {
        background: #2c3e50 !important;
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
      }

      .validity-notice {
        background: #fff8e1 !important;
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
      }

      .status-badge {
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
      }

      .status-badge.draft {
        background: #f39c12 !important;
      }

      .info-card {
        background: #f8f9fa !important;
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
      }
    }

    /* ============================================
       Utility Classes
       ============================================ */
    .text-muted {
      color: #7f8c8d;
    }

    .text-success {
      color: #27ae60;
    }

    .text-danger {
      color: #e74c3c;
    }

    .font-mono {
      font-family: 'SF Mono', 'Consolas', 'Monaco', monospace;
    }

    .mt-10 { margin-top: 10px; }
    .mb-10 { margin-bottom: 10px; }
  </style>
</head>
<body>
  <div class="page">
    <!-- ============================================
         HEADER: Company Info & Document Info
         ============================================ -->
    <div class="header">
      <div class="company-info">
        <div class="company-name">{d.company.name}</div>
        <div class="company-details">
          <p>{d.company.address}</p>
          {d.company.phone:ifNE(''):showBegin}<p>Tel: {d.company.phone}{d.company.email:ifNE(''):show(' | Email: ')}{d.company.email}</p>{d.company.phone:showEnd}
          {d.company.website:ifNE(''):showBegin}<p>Web: {d.company.website}</p>{d.company.website:showEnd}
        </div>
      </div>
      <div class="document-info">
        <div class="document-title">Quotation</div>
        <div class="document-number">
          {d.quote_number}
          {d.status:ifEQ('Draft'):showBegin}<span class="status-badge draft">Draft</span>{d.status:showEnd}
          {d.status:ifEQ('Submitted'):showBegin}<span class="status-badge submitted">Submitted</span>{d.status:showEnd}
          {d.status:ifEQ('Ordered'):showBegin}<span class="status-badge ordered">Ordered</span>{d.status:showEnd}
          {d.status:ifEQ('Cancelled'):showBegin}<span class="status-badge cancelled">Cancelled</span>{d.status:showEnd}
        </div>
        <div class="document-dates">
          <p><strong>Date:</strong> {d.transaction_date}</p>
        </div>
      </div>
    </div>

    <!-- ============================================
         CUSTOMER, PREPARED BY & DETAILS - 3-Column Grid
         ============================================ -->
    <div class="info-grid">
      <!-- BILL TO (50%) -->
      <div class="info-card">
        <div class="info-label">Bill To</div>
        <div class="info-name">{d.customer_name}</div>
        <div class="info-details">{d.customer_address}</div>
        {d.customer_email:ifNE(''):showBegin}
        <div class="info-contact">
          <p>{d.customer_email}</p>
          {d.customer_phone:ifNE(''):showBegin}<p>{d.customer_phone}</p>{d.customer_phone:showEnd}
        </div>
        {d.customer_email:showEnd}
        <!-- Contact Person (if specified) -->
        {d.has_contact:ifEQ(true):showBegin}
        <div class="info-contact">
          <p><strong>Attn:</strong> {d.contact_name}</p>
          {d.contact_email:ifNE(''):showBegin}<p>{d.contact_email}</p>{d.contact_email:showEnd}
        </div>
        {d.has_contact:showEnd}
      </div>

      <!-- PREPARED BY (25%) -->
      <div class="info-card prepared-by">
        <div class="info-label">Prepared By</div>
        <div class="info-name">{d.prepared_by}</div>
        <div class="info-details">{d.company.name}</div>
      </div>

      <!-- DETAILS (25%) -->
      <div class="info-card details">
        <div class="info-label">Details</div>
        <div class="details-row">
          <span class="label">Date:</span>
          <span class="value">{d.transaction_date}</span>
        </div>
        <div class="details-row">
          <span class="label">Valid Until:</span>
          <span class="value">{d.valid_till}</span>
        </div>
        <div class="details-row">
          <span class="label">Currency:</span>
          <span class="value">{d.currency}</span>
        </div>
        <div class="details-row">
          <span class="label">Items:</span>
          <span class="value">{d.item_count}</span>
        </div>
        <div class="details-row">
          <span class="label">Total Qty:</span>
          <span class="value">{d.total_qty:formatN(2)}</span>
        </div>
        {d.lead_time_weeks:ifGT(0):showBegin}
        <div class="details-row">
          <span class="label">Lead Time:</span>
          <span class="value">{d.lead_time_weeks} weeks</span>
        </div>
        {d.lead_time_weeks:showEnd}
      </div>
    </div>

    <!-- ============================================
         LINE ITEMS TABLE
         ============================================ -->
    <div class="items-section">
      <div class="section-title">Quotation Items</div>
      <table class="items-table">
        <thead>
          <tr>
            <th style="width: 40px;">#</th>
            <th style="width: 25%;">Item</th>
            <th>Description</th>
            <th class="text-center" style="width: 60px;">Qty</th>
            <th class="text-center" style="width: 50px;">UOM</th>
            <th class="text-right" style="width: 90px;">Rate</th>
            <th class="text-right" style="width: 100px;">Amount</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="text-center">{d.items[i].row_num}</td>
            <td>
              <div class="item-code">{d.items[i].item_code}</div>
              {d.items[i].item_name:ifNE(''):showBegin}
              <div class="item-description">{d.items[i].item_name}</div>
              {d.items[i].item_name:showEnd}
            </td>
            <td>
              <div>{d.items[i].description}</div>
              <!-- Dimensions (if any) -->
              {d.items[i].dimension_1:ifGT(0):showBegin}
              <div class="item-dimensions">
                Dim: {d.items[i].dimension_1:formatN(2)} x {d.items[i].dimension_2:formatN(2)}
                {d.items[i].wall_thickness:ifGT(0):show('| Wall: ')}{d.items[i].wall_thickness:ifGT(0):formatN(2)}
              </div>
              {d.items[i].dimension_1:showEnd}
              <!-- Notes (if any) -->
              {d.items[i].has_notes:ifEQ(true):showBegin}
              <div class="item-notes">{d.items[i].notes}</div>
              {d.items[i].has_notes:showEnd}
              <!-- Lead time (if any) -->
              {d.items[i].has_lead_time:ifEQ(true):showBegin}
              <div class="item-lead-time">Lead time: {d.items[i].lead_time} {d.items[i].lead_time_unit}</div>
              {d.items[i].has_lead_time:showEnd}
            </td>
            <td class="text-center">{d.items[i].qty_formatted}</td>
            <td class="text-center">{d.items[i].uom}</td>
            <td class="text-right">{d.items[i].rate_formatted}</td>
            <td class="text-right"><strong>{d.items[i].amount_formatted}</strong></td>
          </tr>
          {d.items[i+1]}
        </tbody>
      </table>
    </div>

    <!-- ============================================
         TOTALS SECTION + VALIDITY NOTICE
         ============================================ -->
    <div class="totals-validity-section">
      <!-- Validity Notice (left side) -->
      <div class="validity-notice">
        <span class="validity-icon">⚠️</span>
        <strong>Valid until {d.valid_till}</strong> ({d.days_valid} days from issue)<br>
        Prices and availability subject to change after this date.
      </div>

      <!-- Totals Box (right side) -->
      <div class="totals-box">
        <div class="totals-row">
          <span class="totals-label">Subtotal</span>
          <span class="totals-value">{d.subtotal_formatted}</span>
        </div>

        <!-- Freight (conditional) -->
        {d.has_freight:ifEQ(true):showBegin}
        <div class="totals-row freight">
          <span class="totals-label">Freight</span>
          <span class="totals-value">+ {d.freight_total_formatted}</span>
        </div>
        {d.has_freight:showEnd}

        <!-- Discount (conditional) -->
        {d.has_discount:ifEQ(true):showBegin}
        <div class="totals-row discount">
          <span class="totals-label">Discount</span>
          <span class="totals-value">- {d.discount_formatted}</span>
        </div>
        {d.has_discount:showEnd}

        <!-- Tax (conditional) -->
        {d.has_tax:ifEQ(true):showBegin}
        <div class="totals-row">
          <span class="totals-label">Tax</span>
          <span class="totals-value">{d.tax_total_formatted}</span>
        </div>
        {d.has_tax:showEnd}

        <div class="totals-row grand-total">
          <span class="totals-label">Total ({d.currency})</span>
          <span class="totals-value">{d.grand_total_formatted}</span>
        </div>
      </div>
    </div>

    <!-- ============================================
         TERMS & CONDITIONS (conditional)
         ============================================ -->
    {d.terms:ifNE(''):showBegin}
    <div class="terms-section">
      <div class="section-title">Terms & Conditions</div>
      <div class="terms-content">{d.terms}</div>
    </div>
    {d.terms:showEnd}

    <!-- ============================================
         PAYMENT TERMS (conditional)
         ============================================ -->
    {d.payment_terms:ifNE(''):showBegin}
    <div class="terms-section">
      <div class="section-title">Payment Terms</div>
      <div class="terms-content">{d.payment_terms}</div>
    </div>
    {d.payment_terms:showEnd}

    <!-- ============================================
         SIGNATURE SECTION
         ============================================ -->
    <div class="signature-section">
      <div class="signature-box">
        <div class="signature-line"></div>
        <div class="signature-label">Customer Acceptance</div>
      </div>
      <div class="signature-box">
        <div class="signature-line"></div>
        <div class="signature-label">Date</div>
      </div>
    </div>

    <!-- ============================================
         FOOTER - Compact Single Line
         ============================================ -->
    <div class="footer">
      <div class="footer-contact">
        <strong>{d.company.name}</strong>
        <span>|</span>
        {d.company.phone}
        <span>|</span>
        {d.company.email}
      </div>
      <div class="footer-tagline">Thank you for the opportunity to quote.</div>
    </div>
  </div>
</body>
</html>
